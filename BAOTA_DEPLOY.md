# å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—

> æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨å®å¡”é¢æ¿ä¸Šéƒ¨ç½² Kiro Account Manager åç«¯ API æœåŠ¡

---

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

### æœåŠ¡å™¨é…ç½®
- **ç³»ç»Ÿ**: CentOS 7+ã€Ubuntu 18.04+ æˆ– Debian 9+
- **å†…å­˜**: è‡³å°‘ 1GB RAM
- **ç£ç›˜**: è‡³å°‘ 10GB å¯ç”¨ç©ºé—´
- **å®å¡”**: Linux é¢æ¿ 7.x æˆ–æ›´é«˜ç‰ˆæœ¬

### å¿…éœ€è½¯ä»¶
- âœ… MySQL 5.7+ æˆ– 8.0+
- âœ… Nginx 1.18+
- âœ… PM2 ç®¡ç†å™¨ï¼ˆå« Node.js 18.x+ï¼‰

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ10åˆ†é’Ÿï¼‰

### æ­¥éª¤ 1ï¼šå®‰è£…å¿…è¦è½¯ä»¶ï¼ˆ5åˆ†é’Ÿï¼‰

#### 1.1 å®‰è£… MySQL 8.0

```
å®å¡”é¢æ¿ â†’ è½¯ä»¶å•†åº— â†’ æœç´¢ "MySQL" â†’ é€‰æ‹© 8.0 ç‰ˆæœ¬ â†’ å®‰è£…
```

**ç­‰å¾…å®‰è£…å®Œæˆ**ï¼ˆçº¦ 3-5 åˆ†é’Ÿï¼‰

#### 1.2 å®‰è£… Nginx

```
è½¯ä»¶å•†åº— â†’ æœç´¢ "Nginx" â†’ é€‰æ‹©æœ€æ–°ç‰ˆæœ¬ â†’ å®‰è£…
```

#### 1.3 å®‰è£… PM2 ç®¡ç†å™¨

```
è½¯ä»¶å•†åº— â†’ æœç´¢ "PM2" â†’ å®‰è£…
```

**æ³¨æ„**: PM2 ä¼šè‡ªåŠ¨å®‰è£… Node.jsï¼ˆæ¨è 18.x æˆ– 20.xï¼‰

---

### æ­¥éª¤ 2ï¼šåˆ›å»ºæ•°æ®åº“ï¼ˆ2åˆ†é’Ÿï¼‰

#### 2.1 åˆ›å»ºæ•°æ®åº“

```
å®å¡”é¢æ¿ â†’ æ•°æ®åº“ â†’ æ·»åŠ æ•°æ®åº“
```

**å¡«å†™ä¿¡æ¯**ï¼š
- æ•°æ®åº“å: `kiro_account_manager`
- ç”¨æˆ·å: `kiro_user`
- å¯†ç : ç‚¹å‡»"ç”Ÿæˆå¯†ç "ï¼ˆ**åŠ¡å¿…å¤åˆ¶ä¿å­˜**ï¼‰
- è®¿é—®æƒé™: `æœ¬åœ°æœåŠ¡å™¨`
- å­—ç¬¦é›†: `utf8mb4`

ç‚¹å‡» **æäº¤** åˆ›å»ºã€‚

#### 2.2 è®°å½•æ•°æ®åº“ä¿¡æ¯

```env
æ•°æ®åº“å: kiro_account_manager
ç”¨æˆ·å: kiro_user
å¯†ç : [åˆšæ‰ç”Ÿæˆçš„å¯†ç ]
ä¸»æœº: localhost
ç«¯å£: 3306
```

**âš ï¸ é‡è¦**: è¯·å°†å¯†ç ä¿å­˜åˆ°è®°äº‹æœ¬ï¼Œåé¢é…ç½®æ—¶éœ€è¦ç”¨åˆ°ã€‚

---

### æ­¥éª¤ 3ï¼šä¸Šä¼ é¡¹ç›®ä»£ç ï¼ˆ3åˆ†é’Ÿï¼‰

#### 3.1 åˆ›å»ºé¡¹ç›®ç›®å½•

```
å®å¡”é¢æ¿ â†’ æ–‡ä»¶ â†’ è¿›å…¥ /www/wwwroot/ â†’ æ–°å»ºæ–‡ä»¶å¤¹ "kiro-api"
```

#### 3.2 ä¸Šä¼ ä»£ç 

**æ–¹å¼ä¸€ï¼šGit å…‹éš†ï¼ˆæ¨èï¼‰**

```
å®å¡”é¢æ¿ â†’ ç»ˆç«¯
```

æ‰§è¡Œå‘½ä»¤ï¼š

```bash
cd /www/wwwroot
git clone https://github.com/ä½ çš„ç”¨æˆ·å/kiro-account-manager.git kiro-api
cd kiro-api
```

**æ–¹å¼äºŒï¼šæ‰‹åŠ¨ä¸Šä¼ **

1. åœ¨æœ¬åœ°å°† `server` æ–‡ä»¶å¤¹å‹ç¼©ä¸º `server.zip`
2. åœ¨å®å¡”æ–‡ä»¶ç®¡ç†ä¸­ä¸Šä¼ åˆ° `/www/wwwroot/kiro-api/`
3. å³é”®è§£å‹

**éªŒè¯ä¸Šä¼ **ï¼š

```bash
ls /www/wwwroot/kiro-api/server
# åº”è¯¥çœ‹åˆ°: src  package.json  .env.example ç­‰æ–‡ä»¶
```

---

### æ­¥éª¤ 4ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆ2åˆ†é’Ÿï¼‰

#### 4.1 åˆ›å»º .env é…ç½®æ–‡ä»¶

```
å®å¡”é¢æ¿ â†’ æ–‡ä»¶ â†’ è¿›å…¥ /www/wwwroot/kiro-api/server/
â†’ æ–°å»ºæ–‡ä»¶ ".env"
```

**å¤åˆ¶ä»¥ä¸‹å†…å®¹å¹¶ä¿®æ”¹**ï¼š

```env
# æœåŠ¡å™¨ç«¯å£
PORT=3001

# JWT å¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ï¼‰
JWT_SECRET=è¯·åœ¨è¿™é‡Œç²˜è´´32ä½ä»¥ä¸Šçš„éšæœºå­—ç¬¦ä¸²

# ç®¡ç†å‘˜è´¦å·
ADMIN_USERNAME=admin
ADMIN_PASSWORD=Admin@123456

# MySQL æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=kiro_user
DB_PASSWORD=åœ¨è¿™é‡Œç²˜è´´æ­¥éª¤2ä¿å­˜çš„æ•°æ®åº“å¯†ç 
DB_NAME=kiro_account_manager

# CORS é…ç½®ï¼ˆæ”¹ä¸ºä½ çš„åŸŸåï¼‰
CORS_ORIGIN=https://api.yourdomain.com
```

#### 4.2 ç”Ÿæˆ JWT å¯†é’¥

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**å¤åˆ¶è¾“å‡ºçš„å­—ç¬¦ä¸²**ï¼Œç²˜è´´åˆ° `.env` æ–‡ä»¶çš„ `JWT_SECRET=` åé¢ã€‚

#### 4.3 é…ç½®æ£€æŸ¥æ¸…å•

- [ ] `JWT_SECRET` å·²ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼ˆè‡³å°‘32ä½ï¼‰
- [ ] `DB_PASSWORD` å·²å¡«å†™ä¸ºæ­¥éª¤2çš„æ•°æ®åº“å¯†ç 
- [ ] `CORS_ORIGIN` å·²æ”¹ä¸ºä½ çš„å®é™…åŸŸå
- [ ] `ADMIN_PASSWORD` å»ºè®®ä¿®æ”¹ä¸ºå¼ºå¯†ç 

---

### æ­¥éª¤ 5ï¼šå®‰è£…ä¾èµ–å¹¶åˆå§‹åŒ–ï¼ˆ3åˆ†é’Ÿï¼‰

#### 5.1 å®‰è£… Node.js ä¾èµ–

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/kiro-api/server
npm install --production
```

**ç­‰å¾…å®‰è£…å®Œæˆ**ï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰ã€‚

#### 5.2 åˆå§‹åŒ–æ•°æ®åº“

```bash
npm run db:init
```

**æˆåŠŸè¾“å‡ºç¤ºä¾‹**ï¼š

```
âœ… æ•°æ®åº“ kiro_account_manager å·²åˆ›å»º/å­˜åœ¨
âœ… MySQL è¿æ¥æˆåŠŸ
âœ… users è¡¨å·²åˆ›å»º
âœ… admins è¡¨å·²åˆ›å»º
âœ… kiro_accounts è¡¨å·²åˆ›å»º
âœ… assignments è¡¨å·²åˆ›å»º
âœ… usage_logs è¡¨å·²åˆ›å»º
âœ… admin_audit_logs è¡¨å·²åˆ›å»º
âœ… é»˜è®¤ç®¡ç†å‘˜å·²åˆ›å»º: admin
âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
```

å¦‚æœçœ‹åˆ°ä»¥ä¸Šè¾“å‡ºï¼Œè¯´æ˜æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸï¼

---

### æ­¥éª¤ 6ï¼šå¯åŠ¨åº”ç”¨ï¼ˆ2åˆ†é’Ÿï¼‰

#### 6.1 ä½¿ç”¨ PM2 ç®¡ç†å™¨å¯åŠ¨

```
å®å¡”é¢æ¿ â†’ è½¯ä»¶å•†åº— â†’ PM2 ç®¡ç†å™¨ â†’ è®¾ç½®
```

ç‚¹å‡» **æ·»åŠ é¡¹ç›®**ï¼Œå¡«å†™ï¼š

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| é¡¹ç›®åç§° | `kiro-api` |
| å¯åŠ¨æ–‡ä»¶ | `/www/wwwroot/kiro-api/server/src/index.js` |
| é¡¹ç›®è·¯å¾„ | `/www/wwwroot/kiro-api/server` |
| è¿è¡Œæ¨¡å¼ | `fork` |

ç‚¹å‡» **æäº¤**ã€‚

#### 6.2 éªŒè¯å¯åŠ¨çŠ¶æ€

åœ¨ PM2 ç®¡ç†å™¨ä¸­æŸ¥çœ‹ï¼š
- çŠ¶æ€åº”è¯¥æ˜¾ç¤ºä¸º **online** âœ…
- ç‚¹å‡» **æ—¥å¿—** æŸ¥çœ‹è¾“å‡º

**æˆåŠŸæ—¥å¿—ç¤ºä¾‹**ï¼š

```
MySQL è¿æ¥æˆåŠŸ
æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ 3001
```

#### 6.3 å‘½ä»¤è¡ŒéªŒè¯ï¼ˆå¯é€‰ï¼‰

```bash
pm2 list
# åº”è¯¥çœ‹åˆ° kiro-api çŠ¶æ€ä¸º online

pm2 logs kiro-api --lines 20
# æŸ¥çœ‹æœ€è¿‘20è¡Œæ—¥å¿—
```

---

### æ­¥éª¤ 7ï¼šé…ç½® Nginx åå‘ä»£ç†ï¼ˆ3åˆ†é’Ÿï¼‰

#### 7.1 æ·»åŠ ç½‘ç«™

```
å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ æ·»åŠ ç«™ç‚¹
```

**å¡«å†™ä¿¡æ¯**ï¼š

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| åŸŸå | `api.yourdomain.com` |
| æ ¹ç›®å½• | `/www/wwwroot/kiro-api` |
| PHP ç‰ˆæœ¬ | `çº¯é™æ€` |
| æ•°æ®åº“ | ä¸åˆ›å»º |

ç‚¹å‡» **æäº¤**ã€‚

#### 7.2 é…ç½®åå‘ä»£ç†

æ‰¾åˆ°åˆšåˆ›å»ºçš„ç½‘ç«™ï¼Œç‚¹å‡» **è®¾ç½®**ï¼š

```
è®¾ç½® â†’ åå‘ä»£ç† â†’ æ·»åŠ åå‘ä»£ç†
```

**å¡«å†™ä¿¡æ¯**ï¼š

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| ä»£ç†åç§° | `kiro-api` |
| ç›®æ ‡ URL | `http://127.0.0.1:3001` |
| å‘é€åŸŸå | `$host` |

ç‚¹å‡» **æäº¤**ã€‚

#### 7.3 ç”³è¯· SSL è¯ä¹¦ï¼ˆå¼ºçƒˆæ¨èï¼‰

```
è®¾ç½® â†’ SSL â†’ Let's Encrypt
```

1. å‹¾é€‰ä½ çš„åŸŸå
2. ç‚¹å‡» **ç”³è¯·**
3. ç­‰å¾…ç”³è¯·æˆåŠŸ
4. å¼€å¯ **å¼ºåˆ¶ HTTPS**

#### 7.4 ä¼˜åŒ– Nginx é…ç½®

ç‚¹å‡» **é…ç½®æ–‡ä»¶**ï¼Œæ‰¾åˆ° `location /` å—ï¼Œæ›¿æ¢ä¸ºï¼š

```nginx
location / {
    proxy_pass http://127.0.0.1:3001;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_cache_bypass $http_upgrade;
    
    # è¶…æ—¶é…ç½®
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # è¯·æ±‚ä½“å¤§å°
    client_max_body_size 10m;
}
```

ä¿å­˜åç‚¹å‡» **é‡è½½é…ç½®**ã€‚

---

### æ­¥éª¤ 8ï¼šå®‰å…¨é…ç½®ï¼ˆ2åˆ†é’Ÿï¼‰

#### 8.1 é…ç½®é˜²ç«å¢™

```
å®å¡”é¢æ¿ â†’ å®‰å…¨
```

**ç¡®ä¿å¼€æ”¾**ï¼š
- âœ… `80` - HTTP
- âœ… `443` - HTTPS

**ç¡®ä¿å…³é—­**ï¼ˆä¸å¯¹å¤–å¼€æ”¾ï¼‰ï¼š
- âŒ `3001` - Node.js ç«¯å£
- âŒ `3306` - MySQL ç«¯å£

#### 8.2 é™åˆ¶ç®¡ç†å‘˜æ¥å£è®¿é—®ï¼ˆå¯é€‰ï¼‰

ç¼–è¾‘ Nginx é…ç½®ï¼Œæ·»åŠ  IP ç™½åå•ï¼š

```nginx
# é™åˆ¶ç®¡ç†å‘˜æ¥å£åªèƒ½ä»ç‰¹å®š IP è®¿é—®
location /api/admin {
    # å…è®¸çš„ IPï¼ˆæ”¹ä¸ºä½ çš„ IPï¼‰
    allow 123.456.789.0;
    deny all;
    
    proxy_pass http://127.0.0.1:3001;
    # ... å…¶ä»–é…ç½®
}
```

---

### æ­¥éª¤ 9ï¼šæµ‹è¯•éƒ¨ç½²ï¼ˆ1åˆ†é’Ÿï¼‰

#### 9.1 å¥åº·æ£€æŸ¥

åœ¨æµè§ˆå™¨æˆ–ç»ˆç«¯æµ‹è¯•ï¼š

```bash
curl https://api.yourdomain.com/health
```

**é¢„æœŸè¿”å›**ï¼š
```json
{"status":"ok"}
```

#### 9.2 æµ‹è¯•ç®¡ç†å‘˜ç™»å½•

```bash
curl -X POST https://api.yourdomain.com/api/auth/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"Admin@123456"}'
```

**é¢„æœŸè¿”å›**ï¼š
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "admin": {
    "id": 1,
    "username": "admin",
    "role": "admin"
  }
}
```

å¦‚æœè¿”å› tokenï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼ğŸ‰

---

## ğŸ‰ éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] MySQL å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] Nginx å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] PM2 ç®¡ç†å™¨å·²å®‰è£…
- [ ] æ•°æ®åº“å·²åˆ›å»ºï¼ˆkiro_account_managerï¼‰
- [ ] é¡¹ç›®ä»£ç å·²ä¸Šä¼ 
- [ ] .env æ–‡ä»¶å·²æ­£ç¡®é…ç½®
- [ ] ä¾èµ–å·²å®‰è£…ï¼ˆnpm installï¼‰
- [ ] æ•°æ®åº“å·²åˆå§‹åŒ–ï¼ˆnpm run db:initï¼‰
- [ ] PM2 åº”ç”¨çŠ¶æ€ä¸º online
- [ ] Nginx åå‘ä»£ç†å·²é…ç½®
- [ ] SSL è¯ä¹¦å·²ç”³è¯·å¹¶å¯ç”¨
- [ ] é˜²ç«å¢™å·²æ­£ç¡®é…ç½®
- [ ] API å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] ç®¡ç†å‘˜ç™»å½•æµ‹è¯•é€šè¿‡

---

## ğŸ”§ æ—¥å¸¸è¿ç»´

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—

**æ–¹å¼ä¸€ï¼šPM2 ç®¡ç†å™¨**
```
è½¯ä»¶å•†åº— â†’ PM2 ç®¡ç†å™¨ â†’ æ‰¾åˆ° kiro-api â†’ ç‚¹å‡»"æ—¥å¿—"
```

**æ–¹å¼äºŒï¼šå‘½ä»¤è¡Œ**
```bash
pm2 logs kiro-api          # å®æ—¶æ—¥å¿—
pm2 logs kiro-api --lines 50  # æœ€è¿‘50è¡Œ
pm2 logs kiro-api --err    # åªçœ‹é”™è¯¯
```

### é‡å¯åº”ç”¨

```bash
pm2 restart kiro-api
```

æˆ–åœ¨ PM2 ç®¡ç†å™¨ä¸­ç‚¹å‡» **é‡å¯** æŒ‰é’®ã€‚

### åœæ­¢åº”ç”¨

```bash
pm2 stop kiro-api
```

### æ›´æ–°ä»£ç 

```bash
cd /www/wwwroot/kiro-api
git pull
cd server
npm install --production
pm2 restart kiro-api
```

### æ•°æ®åº“å¤‡ä»½

**è®¾ç½®è‡ªåŠ¨å¤‡ä»½**ï¼š
```
å®å¡”é¢æ¿ â†’ è®¡åˆ’ä»»åŠ¡ â†’ æ·»åŠ ä»»åŠ¡
```

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| ä»»åŠ¡ç±»å‹ | å¤‡ä»½æ•°æ®åº“ |
| ä»»åŠ¡åç§° | å¤‡ä»½ Kiro æ•°æ®åº“ |
| æ‰§è¡Œå‘¨æœŸ | æ¯å¤© |
| æ‰§è¡Œæ—¶é—´ | å‡Œæ™¨ 3:00 |
| å¤‡ä»½æ•°æ®åº“ | kiro_account_manager |
| ä¿ç•™ä»½æ•° | 7 |

**æ‰‹åŠ¨å¤‡ä»½**ï¼š
```
æ•°æ®åº“ â†’ æ‰¾åˆ° kiro_account_manager â†’ å¤‡ä»½
```

---

## ğŸ”’ å®‰å…¨åŠ å›º

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

**é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹**ï¼š
- âœ… ç®¡ç†å‘˜å¯†ç ï¼ˆadmin/Admin@123456ï¼‰
- âœ… MySQL root å¯†ç 
- âœ… å®å¡”é¢æ¿å¯†ç 

### 2. å¼ºåŒ–å¯†é’¥é…ç½®

- âœ… `JWT_SECRET`: è‡³å°‘ 32 ä½éšæœºå­—ç¬¦
- âœ… æ•°æ®åº“å¯†ç : è‡³å°‘ 16 ä½ï¼ŒåŒ…å«å¤§å°å†™ã€æ•°å­—ã€ç¬¦å·
- âœ… ç®¡ç†å‘˜å¯†ç : è‡³å°‘ 12 ä½å¼ºå¯†ç 

### 3. é™åˆ¶ç®¡ç†å‘˜æ¥å£ï¼ˆæ¨èï¼‰

ç¼–è¾‘ Nginx é…ç½®ï¼Œæ·»åŠ  IP ç™½åå•ï¼š

```nginx
# åªå…è®¸ç‰¹å®š IP è®¿é—®ç®¡ç†å‘˜æ¥å£
location /api/admin {
    allow ä½ çš„IPåœ°å€;
    deny all;
    
    proxy_pass http://127.0.0.1:3001;
    # ... å…¶ä»–é…ç½®
}
```

### 4. å¯ç”¨ Fail2banï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰

```
è½¯ä»¶å•†åº— â†’ æœç´¢ "Fail2ban" â†’ å®‰è£…
```

### 5. å®šæœŸæ›´æ–°

```bash
# æ›´æ–°ç³»ç»ŸåŒ…
yum update -y        # CentOS
apt update && apt upgrade -y  # Ubuntu

# æ›´æ–°é¡¹ç›®ä¾èµ–
cd /www/wwwroot/kiro-api/server
npm update
pm2 restart kiro-api
```

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. åº”ç”¨æ— æ³•å¯åŠ¨

**æ£€æŸ¥æ—¥å¿—**ï¼š
```bash
pm2 logs kiro-account-server --err
```

**å¸¸è§åŸå› **ï¼š
- ç«¯å£è¢«å ç”¨ï¼šä¿®æ”¹ `.env` ä¸­çš„ `PORT`
- æ•°æ®åº“è¿æ¥å¤±è´¥ï¼šæ£€æŸ¥ `.env` ä¸­çš„æ•°æ®åº“é…ç½®
- ä¾èµ–æœªå®‰è£…ï¼šè¿è¡Œ `npm install`

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥**ï¼š
- MySQL æ˜¯å¦è¿è¡Œï¼š`systemctl status mysqld`
- æ•°æ®åº“ç”¨æˆ·æƒé™æ˜¯å¦æ­£ç¡®
- `.env` ä¸­çš„æ•°æ®åº“å¯†ç æ˜¯å¦æ­£ç¡®

**è§£å†³**ï¼š
```bash
# é‡å¯ MySQL
systemctl restart mysqld

# æ£€æŸ¥æ•°æ®åº“
mysql -u kiro_user -p
```

### 3. 502 Bad Gateway

**åŸå› **ï¼šNode.js åº”ç”¨æœªè¿è¡Œ

**è§£å†³**ï¼š
```bash
pm2 restart kiro-account-server
pm2 logs kiro-account-server
```

### 4. CORS é”™è¯¯

**æ£€æŸ¥** `.env` ä¸­çš„ `CORS_ORIGIN` é…ç½®ï¼š
```env
# å…è®¸å¤šä¸ªåŸŸå
CORS_ORIGIN=https://yourdomain.com,https://www.yourdomain.com

# å¼€å‘ç¯å¢ƒå…è®¸æ‰€æœ‰ï¼ˆä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰
CORS_ORIGIN=*
```

### 5. å†…å­˜ä¸è¶³

**æŸ¥çœ‹å†…å­˜ä½¿ç”¨**ï¼š
```bash
pm2 monit
```

**ä¼˜åŒ–**ï¼š
- ä½¿ç”¨ `fork` æ¨¡å¼è€Œä¸æ˜¯ `cluster`
- é™åˆ¶ Node.js å†…å­˜ï¼š`pm2 start src/index.js --max-memory-restart 500M`

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å¯ç”¨ Gzip å‹ç¼©

åœ¨ Nginx é…ç½®ä¸­æ·»åŠ ï¼š
```nginx
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
```

### 2. å¯ç”¨ç¼“å­˜

```nginx
location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    expires 7d;
    add_header Cache-Control "public, immutable";
}
```

### 3. æ•°æ®åº“ä¼˜åŒ–

```sql
-- æ·»åŠ ç´¢å¼•ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
USE kiro_account_manager;

-- æ£€æŸ¥ç´¢å¼•
SHOW INDEX FROM users;
SHOW INDEX FROM kiro_accounts;
SHOW INDEX FROM assignments;
```

### 4. PM2 é›†ç¾¤æ¨¡å¼ï¼ˆå¤šæ ¸ CPUï¼‰

```bash
pm2 start src/index.js --name kiro-account-server -i max
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹ PM2 æ—¥å¿—ï¼š`pm2 logs kiro-account-server`
2. æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—ï¼š`/www/wwwroot/kiro-account-manager/log/error.log`
3. æŸ¥çœ‹ MySQL æ—¥å¿—ï¼š`/www/server/data/mysql-error.log`

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] MySQL å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] Nginx å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] PM2 ç®¡ç†å™¨å·²å®‰è£…
- [ ] æ•°æ®åº“å·²åˆ›å»º
- [ ] é¡¹ç›®ä»£ç å·²ä¸Šä¼ 
- [ ] `.env` æ–‡ä»¶å·²é…ç½®
- [ ] ä¾èµ–å·²å®‰è£…ï¼ˆ`npm install`ï¼‰
- [ ] æ•°æ®åº“å·²åˆå§‹åŒ–ï¼ˆ`npm run db:init`ï¼‰
- [ ] åº”ç”¨å·²å¯åŠ¨ï¼ˆPM2ï¼‰
- [ ] Nginx åå‘ä»£ç†å·²é…ç½®
- [ ] SSL è¯ä¹¦å·²é…ç½®
- [ ] é˜²ç«å¢™å·²é…ç½®
- [ ] API æµ‹è¯•é€šè¿‡
- [ ] ç®¡ç†å‘˜ç™»å½•æµ‹è¯•é€šè¿‡
- [ ] æ•°æ®åº“å¤‡ä»½å·²è®¾ç½®

---

**éƒ¨ç½²å®Œæˆï¼** ğŸ‰

ä½ çš„ Kiro Account Manager åç«¯æœåŠ¡ç°åœ¨å·²ç»åœ¨å®å¡”é¢æ¿ä¸ŠæˆåŠŸè¿è¡Œäº†ã€‚
---
noteId: "ca9d5f40db1611f0b7308b83690d5da1"
tags: []

---

